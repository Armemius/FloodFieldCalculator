# Flood field calculator

Utility that is used to calculate expected image of a flood field on a given parameters

To run this project you need to provide config file as a cli parameter:

```shell
FloodFieldCalculator.exe "config.json"
```

## Sample config

```json
{
  "system": {
    "target-resolution": {
      "width": 32,
      "height": 896
    },
    "output-type": "DICOM",
    "blur-radius": 0,
    "K": 10.0
  },
  "signal": [1.0],
  "detector": {
    "type": "CURVED",
    "resolution": {
      "width": 32,
      "height": 896
    },
    "size": {
      "width": 32.0,
      "height": 896.0
    },
    "distance": 1040.0,
    "radius": 1040.0
  },
  "filters": [
    {"type": "CYLINDRICAL", "attenuation-coefficients": [1.5], "distance": 63.0, "thickness": 50, "radius": 110},
    {"type": "FLAT", "attenuation-coefficients": [1.5], "distance": 90.0, "thickness": 1.0}
  ],
  "collimators": [
    {"type": "VERTICAL", "distance": 5, "gap": 0.1}
  ]
}
```

## Config structure

Configuration file consists of several sections, each representing some part of a system

### System

JSON field: "system"

Represents parameters of an output file

#### Target resolution

JSON field: "target-resolution"

Specifies output image resolution

##### Width

JSON field: "width" : int

Width of an output image

##### Height

JSON field: "height" : int

Height of an output image

#### Output type

JSON field: "output-type" : string

Possible values:

* TIFF: tiff image using 8-bit pixel data
* TIFF-16: tiff image using 16-bit pixel data
* DICOM: dicom image

#### Blur radius

JSON field: "blur-radius" : int

Specifies blur radius for post-processing for output image

#### K parameter

JSON field: "K" (overrides "Flood field zero" parameter) : int

Coefficient K for pixel data normalization

Normalization formula: $-K\cdot\ln(V_{ij})$

#### Flood field zero

JSON field: "flood_field0" : string

Path to flood_field0 used for pixel data normalization

Normalization formula: $-F_{ij}\cdot\ln(V_{ij})$

### Signal

JSON field: "signal" : Array<double>

Coefficients for spectral channels

### Detector

JSON field: "detector"

#### Type

JSON field: "type" : string

Form-factor of detector

Possible values:

* FLAT: flat detector
* CURVED: cylindrical detector

#### Resolution

JSON field: "resolution"

Resolution of detector

##### Width

JSON field: "width" : int

Width of image generated by detector

##### Height

JSON field: "height" : int

Height of image generated by detector

#### Size

JSON field: "resolution"

Size of detector in millimeters

##### Width

JSON field: "width" : int

Width of detector

##### Height

JSON field: "height" : int

Height of detector

#### Distance

JSON field: "distance" : double

Distance from emitter to detector in millimeters

#### Radius (type: Curved)

JSON field: "radius" : double

Curve radius of a cylindrical detector

### Filters

JSON field: "filters"

Array of filters attached to a system

#### Type

JSON field: "type" : string

Form-factor of detector

Possible values:

* FLAT: flat filter
* CURVED: parabolic bow-tie filter
* CYLINDRICAL: cylindrical bow-tie filter

#### Attenuation coefficients

JSON field: "attenuation-coefficients" : Array<double>

Attenuation coefficients for each spectral channel of a signal

#### Distance

JSON field: "distance" : double

Distance from emitter to filter in millimeters

#### Thickness (type: FLAT / CYLINDRICAL)

JSON field: "thickness" : double

Thickness of filter in millimeters

#### Minimal thickness (type: CURVED)

JSON field: "min-thickness" : double

Min thickness of filter in millimeters

#### Maximal thickness (type: CURVED)

JSON field: "max-thickness" : double

Max thickness of filter in millimeters

#### Curve radius (type: CURVED / CYLINDRICAL)

JSON field: "radius" : double

Curve radius of cylindrical or parabolic filter

### Collimators

JSON field: "collimators"

Array of collimators attached to a system

#### Type

JSON field: "type" : string

Orientation of collimator

Possible values:

* VERTICAL: gap orientation is vertical
* HORIZONTAL: gap orientation is horizontal

#### Distance

JSON field: "distance" : double

Distance from emitter to collimator in millimeters

#### Gap

JSON field: "gap" : double

Distance between plates of collimator in millimeters
